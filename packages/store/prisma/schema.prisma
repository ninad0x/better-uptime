
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  id          String    @id   @default(uuid())
  username    String    @unique
  password    String
  websites    Website[]
}

model Website {
  id          String    @id    @default(uuid())
  url         String
  user_id     String
  timeAdded   DateTime    @default(now())
  ticks       WebsiteTick[]
  metric      WebsiteMetric[]
  user        Users       @relation(fields: [user_id], references: [id])
}


model Region {
  id          String    @id     @default(uuid())
  name        String
  ticks       WebsiteTick[]

}

model WebsiteTick {
  id                    String    @default(uuid())
  created_at            DateTime    @default(now()) @db.Timestamptz()
  response_time_ms      Int
  status                WebsiteStatus
  region_id             String
  website_id            String  

  region                Region  @relation(fields: [region_id], references: [id])
  website               Website @relation(fields: [website_id], references: [id])

  @@id([id, created_at])
}

enum WebsiteStatus {
  Up
  Down
  Unknown
}

model WebsiteMetric {
  id                    String    @default(uuid())

  website_id            String
  window_start          DateTime  @db.Timestamptz()
  window_end            DateTime

  final_status          WebsiteStatus
  uptime_percent        Float
  avg_response_time_ms  Int?

  regions_down_count    Int
  regions_down_list     String[]

  created_at            DateTime   @default(now())

  website               Website    @relation(fields: [website_id], references: [id])

  @@id([id, window_start])
  @@index([website_id, window_start])
}

